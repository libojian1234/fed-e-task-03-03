### 同构应用

- 通过服务端渲染首屏直出，解决 SPA 应用首屏渲染慢以及不利于 SEO 问题
- 通过客户端渲染接管页面交互得到更好的用户体验
- 这种方式通常称之为现代化的服务端渲染，也叫同构渲染
- 这种方式构建的应用称之为服务端渲染应用或者是同构应用

### 相关概念

- 什么是渲染

  - 把数据和模板拼接到一起

- 传统的服务端渲染模式

  1. 请求一个地址
  2. 查询页面所需数据
  3. 返回数据
  4. 将数据结合页面模板渲染为 HTML
  5. 返回 HTML

- 传统的服务端渲染在网页越来越复杂的情况下，存在很多不足

  - 前后端代码完全耦合在一起，不利于开发和维护
  - 前段没有足够发挥空间
  - 服务端压力大
  - 用户体验一般

- 客户端渲染

  1. 请求一个地址
  2. 返回空白 HTML
  3. AJAX 请求数据
  4. 查询获取数据
  5. 数据库返回数据给服务端
  6. 服务端返回数据客户端
  7. 动态渲染页面

  【后端】负责处理数据接口，【前端】负责将接口数据渲染到页面，前端更为独立，不再受限于【后端】

- 客户端渲染不足

  - 首屏渲染慢
  - 不利于SEO

- 为什么客户端渲染首屏渲染慢？

  - 客户端先请求到的是空白页面，然后再请求页面的js等文件，最后还要请求数据，这些事串行进行的，所花费的时间就长
  - 服务端渲染直接是数据页面都结合好了直接给客户端的，所以时间短

- 为什么客户端渲染不利于SEO？

  - 以Vue为例，搜索引擎搜索 HTML 页面，拿到的 index.html 是一个模板页面，里面的js 、数据都没有，所以搜索引擎搜索不到页面的准确信息

- 现代化的服务端渲染（同构渲染）

  - 基于 React、Vue 等框架，客户端渲染和服务端渲染的结合
    - 在服务端执行一次，用于实现服务器端渲染（首屏直出）
    - 在客户端在执行一次，用于接管页面交互
  - 核心解决 SEO 和首屏渲染慢的问题
  - 拥有传统服务端渲染的优点，也有客户端渲染的优点

- 现代化的服务端渲染（同构渲染）的流程

  1. 请求一个地址
  2. 服务端向接口服务查询页面所需数据
  3. 接口服务返回数据给服务端
  4. 服务端渲染页面以及生成客户端 SPA 脚本
  5. 服务端返回 HTML 给客户端（渲染好的页面内容 + 客户端 SPA 脚本）
  6. 客户端呈现服务端返回的 HTML
  7. 客户端通过页面中的脚本激活为 SPA 应用
  8. 之后的页面交互都是客户端渲染

- 如何实现同构渲染？

  - React、Vue 等框架的官方解决方案
    - 优点：有助于理解原理
    - 缺点：需要搭建环境，比较麻烦
  - 使用第三方解决方案
    - React生态的 Next.js
    - Vue 生态的 Nuxt.js

- 同构渲染应用的问题

  1. 开发条件有限
     - 浏览器特定的代码只能在某些生命周期钩子函数中使用
     - 一些外部扩展库可能需要特殊处理才能在服务端渲染应用中运行
     - 不能再服务端渲染期间操作 DOM
     - ...
     - 某些代码操作需要区分运行环境
  2. 涉及构建和部署的要求很多
     - 客户端渲染仅构建客户端应用即可，同构渲染需要构建两个端
     - 客户端渲染可以部署在任意 Web 服务器中，同构渲染只能部署在 Node.js Server
  3. 更多的服务端负载
     - 在 Node 中渲染完整的应用程序，相比仅仅提供静态文件的服务器需要大量占用 CPU 资源
     - 如果应用在高流量环境中使用，需要准备相应的服务器负载
     - 需要更多的服务端渲染优化工作处理
     - ...

